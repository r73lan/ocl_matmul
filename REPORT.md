# Отчет
## I. Структура кода
Файл main.cpp состоит из вспомогательных функций, объявления структур и main
### Вспомогательные структуры для хранения списков девайсов и платформ
  - ```cpp 
    struct DeviceInfo {
	std::string deviceName;
	cl_device_id deviceId;
	cl_device_type deviceType;
	std::string platformName;
    };
    ```
  - ```cpp 
    struct PlatformDevices {
	cl_platform_id platformId;
	std::string platformName;
	std::vector<DeviceInfo> devices;
    };
    ```
### Вспомогательные функции
  - ```cpp 
    ReadMatrix(...)
    ```
  - ```cpp 
    getAllPlatformsAndDevices()
    ```
  - ```cpp 
    SelectDevice(...)
    ```
  - ```cpp 
    MatMul_omp(...)
    ```
 - ```cpp 
    writeMatrixToFile(...)
    ```
  - ```cpp 
    Transpose(...)
    ```
  - ```cpp 
    releaseOpenCLResources(...)
    ```
  - ```cpp 
    freeMatrixMemory(...)
    ```
### Структура программы

1. Считываются размеры матриц, сами матрицы
2. Выбирается девайс, согласно запросу при вызове в командной строке
3. Вычисляется произведение матриц в зависимости от выбранной реализации
    1. Для реализации 0 вычисляется умножение матриц при помощи функции MatMul_omp, с учетом распараллеливания, используя библиотеку omp
    2. Для реализации 1 вычисляется умножение матриц средствами opencl на выбранном девайсе. В реализации 1 ***не используется*** локальная память девайса, ***1 тред считает 1 матричный элемент*** выходной матрицы $C = A * B$
    3. Для реализации 2 вычисляется умножение матриц средствами opencl на выбранном девайсе. В реализации 2 ***используется*** локальная память девайса, ***1 тред считает 1 матричный элемент*** выходной матрицы $C = A * B$
    4. Для реализации 3 вычисляется умножение матриц средствами opencl на выбранном девайсе. В реализации 2 ***используется*** локальная память девайса, ***1 тред считает несколько матричных элементов (6)*** выходной матрицы $C = A * B$
4. Результат (матрица $C$) записывается в выходной файл, в стандартный вывод отправляется время работы программы.

## II. Про кернелы
Реализация 1: 
```cpp    
kernel void globalmem_r1(...)
```
В кернел подается матрицы $A$, $B$, $C$ и их размеры 

1 тред считает 1 матричный элемент выходной матрицы $C$

Реализация 2:  
```cpp    
kernel void localmem_r2(...)
``` 
В кернел подается матрицы $A^T$, $B$, $C$ и их размеры.

Тайл квадратный, размеры  16 x 16

Число тредов в локальной группе 256

1 тред считает 1 матричный элемент выходной матрицы $C$

Реализация 3:  
```cpp    
kernel void localmem_vector_r3(...)
``` 
В кернел подается матрицы $A^T$, $B$, $C$ и их размеры

Тайл квадратный, размеры  30 x 30

Число тредов в локальной группе 150

1 тред считает 6 матричных элементов выходной матрицы $C$

## III. Результаты тестов на сервере на файле in0.txt

Реализация 1

    Device: gfx1010	Platform: AMD Accelerated Parallel Processing Time: 58.9703	70.4617

Реализация 2

    Device: gfx1010	Platform: AMD Accelerated Parallel Processing Time: 14.7353	22.2118
    LOCAL_WORK_SIZE [16, 16]
    WI_WORK 1

Реализация 3

    Device: gfx1010	Platform: AMD Accelerated Parallel Processing Time: 6.41904	14.0181
    LOCAL_WORK_SIZE [15, 10]
    WI_WORK 6

    LDSBankConflicts, %: 6.25



